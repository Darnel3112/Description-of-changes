Внешняя обработка «Обработка заполнения состояний активов БП ИТИЛ»

Обработка берет данные по основным средствам в БП, выгружает их в xml. Затем читает этот файл в ITIL, обрабатывает их, создает на основании данных документ "Перемещение активов" и проводит его, 
затем записывает результат обработки в новый файл xml. После этого новый файл читается в БП и на основании полученных данных производится запись в регистр сведений "пр_ОсновныеСредстваITIL"


Данная обработка может запускаться как в ITIL, так и в БП. 
Обработка использует одну форму. Форма адаптируется под систему, опираясь на имя конфигурации.

Обработка.Форма содержит следующие элементы:
1) Таблицы формы: 
    а) "ТЗДанныхБП":
        а1) "ИнвентарныйНомерITIL" - Строка (9)       
        а2) "ДатаПринятияКУчету" - Дата (Дата и время)
        а3) "ГУИДОСВБП" - Строка (36)
        а4) "ГУИДОрганизации" - Строка (36)
        а5) "ОсновноеСредство" - СправочникСсылка.ОсновныеСредства
        а6) "Организация" - СправочникСсылка.Организации
    б) "ТЗДанныхИТИЛ":
        б1) "ИнвентарныйНомерITIL" - Строка (9)       
        б2) "ДатаПринятияКУчету" - Дата (Дата и время)
        б3) "ГУИДОСВБП" - Строка (36)
        б4) "ГУИДОрганизации" - Строка (36)
        б5) "Актив" - СправочникСсылка.itilprofАктивы
        б6) "Фирма" - СправочникСсылка.ПР_Фирмы
2) Команды: "ВыгрузитьДанныеИзБП", "ЗагрузитьДанныеВБП", "ЗагрузитьДанныеИзБП", "ОбновитьВБП", "ОбработатьАктивы"
3) Реквизиты формы: 
    а) "ДанныеВITILОбработаны" - Булево
    б) "ПолныйПутьДоФайлаЗагрузки" - Строка (неограниченной длины)
    в) "ПолныйПутьДоФайлаЗагрузкиДанныхВБП" - Строка (неограниченной длины)
    г) "ПутьЖурналаОшибокВITIL" - Строка (неограниченной длины)
    д) "ПутьЖурналаОшибокВБП" - Строка (неограниченной длины)
    е) "ПутьФайлаВыгрузкиИзБП" - Строка (неограниченной длины)
    ж) "ПутьФайлаОбработанныхАктивов" - Строка (неограниченной длины)

Обработка.Форма.ПриСозданииНаСервере - определение видимости элементов формы (в БП и ITIL), начальное заполнение реквизитов формы (только в БП)

================================================================На стороне БП==============================================

Обработка.Форма.ОбновитьДанныеВБП - запрос данных в БП КОРП и выведение их в таблицу "ТЗДанныхБП"
Обработка.Форма.ВыгрузитьДанныеИзБП - процедура-обработчик команды "ВыгрузитьДанныеИзБП". Запись содержимого таблицы формы "ТЗДанныхБП" в файл с расширением xml. Запись в файл происходит на клиенте
Обработка.Форма.ПодготовитьДанныеДляВыгрузкиИзБП - конвертирование таблицы значений в массив структур, для записи на клиенте
Обработка.Форма.ЗагрузитьДанныеВБП - процедура-обработчик команды "ЗагрузитьДанныеВБП". Чтение файла с данными выгруженными из ITIL и запись их в регистр сведений "пр_ОсновныеСредстваITIL".
Если при записи в регистр произошли ошибки, то они будут записаны в файл с расширением txt. По окончании обработки данных вызов процедуры "ОбновитьДанныеВБП"

Обработка.Форма.ЗагрузитьДанныеВБПНаСервере - обработка прочитанных данных и непосредственная запись в регистр сведений "пр_ОсновныеСредстваITIL"
ОбновитьВБП - процедура-обработчик команды "ОбновитьВБП". Вызывает процедуру "ОбновитьДанныеВБП" для обновления данных в таблице формы "ТЗДанныхБП"

================================================================На стороне ITIL==============================================
Обработка.Форма.ЗагрузитьДанныеИзБП - процедура-обработчик команды "ЗагрузитьДанныеИзБП". Чтение файла xml, предварительная обработка данных и запись обработанных данных в таблицу формы "ТЗДанныхВИТИЛ"
Обработка.Форма.СтруктураВТаблицуЗначенийСОписаниемТипов - конвертация прочитанного из файла массива структура в таблицу значений
Обработка.Форма.ОбработкаЗагруженныхДанных - предварительная обработка загруженных из файла данных перед записью в таблицу формы "ТЗДанныхВИТИЛ"
Обработка.Форма.ОбработатьАктивы - процедура-обработчик команды "ОбработатьАктивы". вызов функции "ОбработатьАктивыНаСервере" и обработка результата выполнения функции, 
в т.ч. запись данных из массива данных в файл с расширением xml. Если при обработке данных возникли ошибки, то запись ошибок из массива ошибок в файл с расширением txt. 

Обработка.Форма.ОбработатьАктивыНаСервере - подготовка данных для вызова процедуры "СоздатьДокументИнвентаризации". Возвращаемое значение - структура с массивом ошибок и массивом данных.
Обработка.Форма.СоздатьДокументИнвентаризации - создание и заполнение документа "Перемещение активов" на основании данных, прочитанных из файла. 
Сначала документ просто записывается, затем проводится. После удачного проведения происходит запись в регистр "ПР_СостояниеАктивов" и заполнение массива данных. 
Если проведение окончилось ошибкой, то заполняется массив ошибок.



