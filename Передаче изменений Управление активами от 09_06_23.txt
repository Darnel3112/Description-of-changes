
=====================================================================ПЕР.ПЭП-01=============================================================================

ОбщийМодуль.ПР_Telegram.ДобавитьПричинуОтклонения - новая функция - записывает причину отклонения подписания и отправляет документ в статус На доработке
ОбщийМодуль.ПР_Telegram.ДокументыНаСогласовании - новая функция - получает ТЗ списка документов на согласовании у пользователя	
ОбщийМодуль.ПР_Telegram.ПодтвердитьСогласованиеДокумента - новая функция - подтверждает согласование подписанта и переводит документ в следующее состояние перемещения и отправляет уведомление следующему подписанту при необходимости
ОбщийМодуль.ПР_Telegram.ПолучитьГлавноеМеню - добавлен вывод кнопки "Документы на согласовании" в главном меню
ОбщийМодуль.ПР_Telegram.ПолучитьЗаявкиПоОчереди - вызов функции ПолучитьНомерСсылкуИнцидента переименован в ПолучитьНомерСсылку	
ОбщийМодуль.ПР_Telegram.ПолучитьМенюПеремещенияАктивов - новая функция - формирует кнопки меню карточки документа
ОбщийМодуль.ПР_Telegram.ПолучитьНомерСсылку - переименована функция ПолучитьНомерСсылкуИнцидента; добавление префикса документа при формировании ссылки-номера документа
ОбщийМодуль.ПР_Telegram.ПолучитьОписаниеЗаявки - изменена обработка получения ссылки документа при нажатии ссылки-номера	
ОбщийМодуль.ПР_Telegram.ПолучитьОписаниеПеремещенияАктивов - новая функция - формирует сообщение описание документа перемещения вместе с кнопками меню
ОбщийМодуль.ПР_Telegram.ПолучитьСписокВсехЗаявок - вызов функции ПолучитьНомерСсылкуИнцидента переименован в ПолучитьНомерСсылку
ОбщийМодуль.ПР_Telegram.ПолучитьСписокДокументовНаСогласовании - новая функция - в зависимости от количество документов на согласовании выводит: список документов, карточку документа, сообщение об отсутствии документов на согласовании
ОбщийМодуль.ПР_Telegram.ПолучитьСписокЗаявокЯИсполнитель - вызов функции ПолучитьНомерСсылкуИнцидента переименован в ПолучитьНомерСсылку
ОбщийМодуль.ПР_Telegram.ПолучитьСписокМоихЗаявок - вызов функции ПолучитьНомерСсылкуИнцидента переименован в ПолучитьНомерСсылку
ОбщийМодуль.ПР_Telegram.СоздатьНовуюЗаявку - вызов функции ПолучитьНомерСсылкуИнцидента переименован в ПолучитьНомерСсылку	
ОбщийМодуль.ПР_Telegram.СписокДокументовНаСогласовании - новая функция - получение текста сообщения со списком документов	на согласовании
ОбщийМодуль.ПР_Telegram.ТекущийПользовательЭтоПодписант - новая функция - проверка является ли текущий пользователю подписантом документа
ОбщийМодуль.ПР_Telegram.ДобавитьОповещениеДляОбработки - добавлена проверка на тип источника при записи инициатора
ОбщийМодуль.ПР_Telegram.ОбработкаСообщений - добавлена обработка нажатия кнопок для согласования документов перемещения активов; изменена обработка нажатия на открытие инидента
ОбщийМодуль.ПР_Telegram.ОтправкаУведомлений - новая экспортная процедура - вызывается в регламентом задании ПР_ОтправкаУведомленийTelegram - формирует оповещения в телеграмм для пользователей, у которых в наличии документы, ожидающие согласования
ОбщийМодуль.ПР_Telegram.ПолучитьИОтправитьПечатнуюФорму - новая процедура - формирует и отправляет файл печатной формы накладной на передачу основное
ОбщийМодуль.ПР_Telegram.РассылкаСообщений - изменен алгоритм формирования текста сообщения; добавлена обработка событий Согласование и Уведомление
ОбщийМодуль.ПР_Telegram.УстановитьЗначенияПользователя - добавлена обработка режима ввода ВводКомментарияОтклоненияСогласования

ОбщиеМодули.ПР_ОтправкаУведомлений.РЗ_ПР_ОтправкаПисемМенеджеру - новая процедура, вызывается регламентным заданием "ПР_ОтправкаПисемМенеджеру"
ОбщиеМодули.ПР_ОтправкаУведомлений.ПР_ОтправкаУведомленияОНеобходимостиРегистрацииВЧатБотеTelegram - новая процедура, отправка электронного письма пользователю о необходимости зарегистрировать в Telegram - боте
===========================================================================

РегламентоеЗадание.ПР_ОтправкаУведомленийTelegram - новое регламентное задание для отправки уведомлений о наличии документов на согласовании ЭП
РегламентоеЗадание.ПР_ОтправкаПисемМенеджеру - новое регламентное задание для отправки уведомлений менеджерам по закупке о расхождениях между заказом и поступлением

===========================================================================

Документ.itilprofПеремещениеАктивов:
1) Новые реквизиты:
    а) ПР_ПричинаОтклоненияСогласования - Строка (150)
    б) ПР_ТипТекущегоПодписанта - ПеречислениеСсылка.ПР_ТипыПодписантов
    в) ПР_ПредыдущееСостояние - ПеречислениеСсылка.ПР_СостоянияПеремещения
2) Новая табличная часть: ПР_ИсторияСогласования, реквизиты ТЧ:
    а) Подписант - СправочникСсылка.ФизическиеЛица
    б) Состояние - ПеречислениеСсылка.ПР_СостоянияСогласования
    в) ДатаСогласования - Дата
    г) Комментарий - Строка(1024)
    д) ТипПодписанта - ПеречислениеСсылка.ПР_ТипыПодписантов

Документ.itilprofПеремещениеАктивов.МодульМенеджера.ПолучитьНовоеСостояниеИлиПодписантаЭП - новая функция для получения следующего состояния и подписанта перемещения

===========================================================================

Документ.itilprofПеремещениеАктивов.ФормаДокумента:
1) Добавлены команды: "ПР_ОтправитьНаСогласование", "ПР_ОтозватьСогласование". Команды выведены на форму
2) Добавлена группа формы "СтраницаСогласования" в неё помещена таблица формы "ПР_ИсторияСогласования" со следующими полями:
    а) "ПР_ИсторияСогласованияПодписант"
    б) "ПР_ИсторияСогласованияСостояние"
    в) "ПР_ИсторияСогласованияДатаСогласования"
    г) "ПР_ИсторияСогласованияКомментарий"

Документ.itilprofПеремещениеАктивов.ФормаДокумента.ПолучитьМоментВремениДокумента - новая фукнция, возвращает текущую дату, или дату или момент времени документа.

Документ.itilprofПеремещениеАктивов.ФормаДокумента.ПР_ОтозватьСогласованиеНаСервере - новая функция - возвращает состояние перемещения в Новый
Документ.itilprofПеремещениеАктивов.ФормаДокумента.ПР_ОтправитьНаСогласованиеНаСервере - новая функция - получает следующее состояние перемещения документа 
и подписанта, отправляет документ на дальнейшее согласование

Документ.itilprofПеремещениеАктивов.ФормаДокумента.ПроверкаРегистрацииПодписантовВЧатБоте - новая функция - получает список незарегистрированных  подписантов в телеграмм

Документ.itilprofПеремещениеАктивов.ФормаДокумента.ЗаполнениеФирм - изменен параметр запроса "МоментВремени"
Документ.itilprofПеремещениеАктивов.ФормаДокумента.Подбор - изменен параметр "МоментВремени" передаваемый на форму "itilprofФормаПодбораАктивов"

Документ.itilprofПеремещениеАктивов.ФормаДокумента.ПР_ОтозватьСогласование - новая процедура - вызывает открытие диалогового окна для подтверждения сброса состояния согласования
Документ.itilprofПеремещениеАктивов.ФормаДокумента.ПР_ОтозватьСогласованиеЗавершить - новая процедура - вызывает сброс состояния согласования; изменяет отображение формы согласно новому состоянию
Документ.itilprofПеремещениеАктивов.ФормаДокумента.УправлениеОчередьюСогласования - новая процедура, очистка очереди согласовния при отклонении согласования
Документ.itilprofПеремещениеАктивов.ФормаДокумента.ПР_ОтправитьНаСогласование - новая процедура - отправляет документ на согласование, при необходимости 
вызывает диалоговое окно с предложением пропустить этап согласования доставщиком при его наличии

Документ.itilprofПеремещениеАктивов.ФормаДокумента.ПР_ОтправитьНаСогласованиеЗавершение - новая процедура - отправляет документ на согласование; изменяет отображение формы согласно новому состоянию
Документ.itilprofПеремещениеАктивов.ФормаДокумента.ПР_ОтправитьНаСогласованиеПродолжить - новая процедура - отправляет документ на согласование с параметром необходимости пропуска этапа 
согласования с доставщиком

Документ.itilprofПеремещениеАктивов.ФормаДокумента.ПриОткрытии - добавлена установка доступности формы в зависимости от состояния перемещения
Документ.itilprofПеремещениеАктивов.ФормаДокумента.УправлениеВидимостьюКнопокСогласования - новая процедура - изменяет отображение кнопок отправки/сброса согласования в зависимости от состояния перемещения

===========================================================================

Перечисление.ПР_ТипыПодписантов - новое перечисление для хранения типа текущего подписанта перемещения активов 
Перечисление.ПР_СостоянияСогласования - новое перечислениеЮ для хранения состояние согласования подписантом
Перечисление.ПР_РежимыВводаTelegram - добавлено новое значение "ВводКомментарияОтклоненияСогласования"

===========================================================================

РегистрСведений.ПР_ПользователиTelegram.МодульМенеджера.ПолучитьПользователяПоФизЛицу - новая функция - производит поиск пользователя для отправки уведомлений в телеграмм по физ лицу
РегистрСведений.ПР_ПользователиTelegram.ФормаЗаписи.ПриСозданииНаСервере - Исправлена ошибка в условии

===========================================================================

РегистрСведений.ПР_ОповещенияДляОбработкиTelegram.Реквизиты.Источник - добавлен тип ДокументСсылка.itilprofПеремещениеАктивов

===========================================================================

РегистрСведений.пит_ГибкийРегистрАналитикОбмена.Ресурс.Значение - изменен тип с Строка(10) на Строка(150)





===========================================================ПЕР.ОБМЕН-06===============================================================================

ОбщиеМодули.ПР_СозданиеДокументовДляОбмена - добавлен новый модуль, в данном модуле будут размещаться методы, необходимы для реализации обмена между ITIL и БП
ОбщиеМодули.ПР_СозданиеДокументовДляОбмена.СоздатьДокумент - в процедуре происходит заполнение и создание технического документа
ОбщиеМодули.ПР_СозданиеДокументовДляОбмена.ТакойДокументЕсть - фунция необходима для поиска нужной строки таблицы со списком документов, 
поиск осуществляется по виду документа и по конфигурационной единице, возвращает ссылку на найденый документ.

ОбщиеМодули.ПР_СозданиеДокументовДляОбмена.СписокДокументов - функция возвращает список документов созданных на основании источника.
ОбщиеМодули.ПР_СозданиеДокументовДляОбмена.ПР_СозданиеДокументовДляОбменаПеремещенияАктивовПриЗаписи - процедура - обработчик для подписки на событие "ПР_СозданиеДокументовДляОбменаПеремещенияАктивов",
является "точкой входа" в механизм обмена между ITIL и БП

ОбщиеМодули.ПР_СозданиеДокументовДляОбмена.ПроверкаНаПринятиеКУчетуОСРазныеФирмы - процедура нужна для определения, создавать или нет 
документ "ПР_ПринятиеКУчетуОСДляОбмена" на основании документа "itilprofПеремещениеАктивов", в случае если перемещение было между разными фирмами

ОбщиеМодули.ПР_СозданиеДокументовДляОбмена.ПроверкаНаПередачаОСИПоступлениеТоваровРазныеФирмы - процедура нужна для определения, создавать или нет 
документы "ПР_ПоступлениеТоваровУслугДляОбмена" и "ПР_ПередачаОСДляОбмена" на основании документа "itilprofПеремещениеАктивов", в случае если перемещение было между разными фирмами 

ОбщиеМодули.ПР_СозданиеДокументовДляОбмена.ПроверкаНаРасходМатериаловРазныеФирмы - процедура нужна для определения, создавать или нет 
документ "ПР_РасходМатериаловДляОбмена" на основании документа "itilprofПеремещениеАктивов", в случае если перемещение было между разными фирмами

ОбщиеМодули.ПР_СозданиеДокументовДляОбмена.ПроверкаНаРеализациюТовараИПоступлениеТовара - процедура нужна для определения, создавать или нет 
документ "ПР_РеализацияТовараДляОбмена" и "ПР_ПоступлениеТоваровУслугДляОбмена" на основании документа "itilprofПеремещениеАктивов", в случае если перемещение было между разными фирмами

ОбщиеМодули.ПР_СозданиеДокументовДляОбмена.ПроверкаНаРасходМатериалов - процедура нужна для определения, создавать или нет 
документ "ПР_РасходМатериаловДляОбмена" на основании документа "itilprofПеремещениеАктивов", в случае если перемещение было между одинаковыми фирмами

ОбщиеМодули.ПР_СозданиеДокументовДляОбмена.ПроверкаНаПринятиеКУчету - процедура нужна для определения, создавать или нет 
документ "ПР_ПринятиеКУчетуОСДляОбмена" на основании документа "itilprofПеремещениеАктивов", в случае если перемещение было между одинаковыми фирмами

ОбщиеМодули.ПР_СозданиеДокументовДляОбмена.ПроверкаНаПеремещениеОСПеремещение - процедура нужна для определения, создавать или нет 
документ "ПР_ПеремещениеОСДляОбмена" на основании документа "itilprofПеремещениеАктивов", если цель = "Перемещение"

ОбщиеМодули.ПР_СозданиеДокументовДляОбмена.ПроверкаНаПеремещениеОСВводВЭксплуатацию - процедура нужна для определения, создавать или нет 
документ "ПР_ПеремещениеОСДляОбмена" на основании документа "itilprofПеремещениеАктивов", если цель = "ВводВЭксплуатацию"

ОбщиеМодули.ПР_СозданиеДокументовДляОбмена.ПроверкаНаПеремещениеТоваров - процедура нужна для определения, создавать или нет 
документ "ПР_ПеремещениеТоваровДляОбмена" на основании документа "itilprofПеремещениеАктивов", в случае если перемещение было между одинаковыми фирмами

ОбщиеМодули.ПР_СозданиеДокументовДляОбмена.ПометкаУдаленияДокументов - процедура нужна для опеределения помечать на удаление документ созданный на основании "itilprofПеремещениеАктивов"

===========================================================================

ПодпискиНаСобытие.ПР_СозданиеДокументовДляОбменаПеремещенияАктивов - новая подписка на событие, для события "ПриЗаписи", документа "itilprofПеремещениеАктивов",
обработчик подписки "ПР_СозданиеДокументовДляОбменаПеремещенияАктивовПриЗаписи" в модуле "ПР_СозданиеДокументовДляОбмена"

===========================================================================

Справочники.ТипыАктивов:
1) Добавлены новые реквизиты:
    а) ПР_ГруппаУчетаОС - ПеречислениеСсылка.ПР_ГруппыУчетаОС
    б) ПР_НазваниеГруппыОСВБП - Строка(150)
    в) ПР_GUIDГруппыОСВБП - Строка(36)
    г) ПР_СтатьяЗатрат - СправочникСсылка.СтатьиЗатрат

Справочники.ТипыАктивов.ФормаДокумента.ОбновитьСвойстваПолейОС (новая)
Справочники.ТипыАктивов.ФормаДокумента.ОбновитьСвойстваПоляСтатьяДДС(новая)
Справочники.ТипыАктивов.ФормаДокумента.

===========================================================================

Документы.ПР_ПеремещениеТоваровДляОбмена - добавлен новый документ, аналогичен подобному документу в БП КОРП
Реквизиты: 1) "Организация" - СправочникСсылка.ПР_Фирмы; 2) "СкладОтправитель" - СправочникСсылка.Склады; 3) "СкладПолучатель" - СправочникСсылка.Склады; 
4) "ПодразделениеПолучатель" - СправочникСсылка.СтруктураПредприятия; 5) "Комментарий" - Строка (неограниченной длины); 6) "ДокументОснование" - ДокументСсылка.itilprofПеремещениеАктивов
7) "Состояние" - ПеречислениеСсылка.ПР_СостоянияПеремещения; 8) "Проект" - СправочникСсылка.ПР_Проекты
Табличная часть: "Товары", реквизиты: 1) "Актив" - СправочникСсылка.itilprofАктивы, СправочникСсылка.itilprofКонфигурационныеЕдиницы; 2) "Количество" - Число (10,3)

Документы.ПР_ПеремещениеОСДляОбмена - добавлен новый документ, аналогичен подобному документу в БП КОРП
Реквизиты: 1) "Организация" - СправочникСсылка.ПР_Фирмы; 2) "ПодразделениеОрганизации" - СправочникСсылка.СтруктураПредприятия; 3) "ПодразделениеПолучатель" - СправочникСсылка.СтруктураПредприятия; 
4) "МОЛОрганизации" - СправочникСсылка.ФизическиеЛица; 5) "МОЛПолучатель" - СправочникСсылка.ФизическиеЛица 6) "Комментарий" - Строка (неограниченной длины); 
6) "ДокументОснование" - ДокументСсылка.itilprofПеремещениеАктивов 7) "Состояние" - ПеречислениеСсылка.ПР_СостоянияПеремещения; 8) "Проект" - СправочникСсылка.ПР_Проекты
Табличная часть: "ОС", реквизиты: 1) "Актив" - СправочникСсылка.itilprofАктивы

Документы.ПР_РеализацияТовараДляОбмена - добавлен новый документ, аналогичен подобному документу в БП КОРП
Реквизиты: 1) "Организация" - СправочникСсылка.ПР_Фирмы; 2) "ПодразделениеОрганизации" - СправочникСсылка.СтруктураПредприятия; 3) "Склад" - СправочникСсылка.Склады; 
4) "Комментарий" - Строка (неограниченной длины); 5) "Перевозчик" - СправочникСсылка.Контрагенты; 6) "ОрганизацияПолучатель" - СправочникСсылка.ПР_Фирмы; 
7) "ДокументОснование" - ДокументСсылка.itilprofПеремещениеАктивов 8) "Состояние" - ПеречислениеСсылка.ПР_СостоянияПеремещения; 9) "Проект" - СправочникСсылка.ПР_Проекты
Табличная часть: "Товары", реквизиты: 1) "КонфигурационнаяЕдиница" - СправочникСсылка.itilprofКонфигурационныеЕдиницы; 2) "ЕдиницаИзмерения" - СправочникСсылка.КлассификаторЕдиницИзмерения
3) "Количество" - Число (10,3); 4) Цена - Число (15,2)

Документы.ПР_ПоступлениеТоваровУслугДляОбмена - добавлен новый документ, аналогичен подобному документу в БП КОРП
Реквизиты: 1) "Организация" - СправочникСсылка.ПР_Фирмы; 2) "ПодразделениеОрганизации" - СправочникСсылка.СтруктураПредприятия; 3) "Склад" - СправочникСсылка.Склады; 
4) "Комментарий" - Строка (неограниченной длины); 5) "ОрганизацияОтправитель" - СправочникСсылка.ПР_Фирмы; 6) "ДокументОснование" - ДокументСсылка.itilprofПеремещениеАктивов 
7) "Состояние" - ПеречислениеСсылка.ПР_СостоянияПеремещения; 8) "Проект" - СправочникСсылка.ПР_Проекты; 9) ДляОС - Булево
Табличная часть: "Оборудование", реквизиты: 1) "КонфигурационнаяЕдиница" - СправочникСсылка.itilprofКонфигурационныеЕдиницы; 2) "ЕдиницаИзмерения" - СправочникСсылка.КлассификаторЕдиницИзмерения
3) "Количество" - Число (10,3); 4) Цена - Число (15,2); 5) "Проект" - СправочникСсылка.ПР_Проекты

Документы.ПР_ПередачаОСДляОбмена - добавлен новый документ, аналогичен подобному документу в БП КОРП
Реквизиты: 1) "Организация" - СправочникСсылка.ПР_Фирмы; 2) "ПодразделениеОрганизации" - СправочникСсылка.СтруктураПредприятия; 3) "Комментарий" - Строка (неограниченной длины); 
4) "ОрганизацияПолучатель" - СправочникСсылка.ПР_Фирмы; 5) "ДокументОснование" - ДокументСсылка.itilprofПеремещениеАктивов 6) "Состояние" - ПеречислениеСсылка.ПР_СостоянияПеремещения; 
7) "Проект" - СправочникСсылка.ПР_Проекты
Табличная часть: "ОС", реквизиты: 1) "Актив" - СправочникСсылка.itilprofАктивы; 2) "ЕдиницаИзмерения" - СправочникСсылка.КлассификаторЕдиницИзмерения
3) "Количество" - Число (10,3); 4) Цена - Число (15,2);

Документы.ПР_РасходМатериаловДляОбмена - добавлен новый документ, аналогичен подобному документу в БП КОРП
Реквизиты: 1) "Организация" - СправочникСсылка.ПР_Фирмы; 2) "ПодразделениеЗатрат" - СправочникСсылка.СтруктураПредприятия; 3) "Комментарий" - Строка (неограниченной длины); 
4) "ДокументОснование" - ДокументСсылка.itilprofПеремещениеАктивов 5) "Состояние" - ПеречислениеСсылка.ПР_СостоянияПеремещения; 6) "СкладВТабличнойЧасти" - Булево
Табличная часть: "Материалы", реквизиты: 1) "КонфигурационнаяЕдиница" - СправочникСсылка.itilprofКонфигурационныеЕдиницы; 2) "ЕдиницаИзмерения" - СправочникСсылка.КлассификаторЕдиницИзмерения
3) "Склад" - СправочникСсылка.Склады; 4) "ПодразделениеЗатрат" - СправочникСсылка.СтруктураПредприятия; 5) "Проект" - СправочникСсылка.ПР_Проекты; 6) "Количество" - Число (10,3)

Документы.ПР_ПринятиеКУчетуОСДляОбмена - добавлен новый документ, аналогичен подобному документу в БП КОРП
Реквизиты: 1) "Организация"  - СправочникСсылка.ПР_Фирмы; 2) "МестонахождениеОС" - СправочникСсылка.СтруктураПредприятия; 3) "Склад" - СправочникСсылка.Склады; 4) "МОЛБУ" - СправочникСсылка.ФизическиеЛица;
5) "ГруппаОС" - ПеречислениеСсылка.ПР_ГруппыУчетаОС; 6) "КонфигурационнаяЕдиница" - СправочникСсылка.itilprofКонфигурационныеЕдиницы; 7) "Комментарий" - Строка (неограниченной длины); 
8) "Договор" - СправочникСсылка.ДоговорыКонтрагентов; 9) "ДокументПоступление" - ДокументСсылка.itilprofПоступлениеАктивов; 10) "Контрагент" - СправочникСсылка.Контрагенты;
11) "Проект" - СправочникСсылка.ПР_Проекты; 12) "ДокументОснование" - ДокументСсылка.itilprofПеремещениеАктивов; 13) "Состояние" - ПеречислениеСсылка.ПР_СостоянияПеремещения
Табличная часть: "ОС", реквизиты: 1) "Актив" - СправочникСсылка.itilprofАктивы;

===========================================================================

Перечисления.ПР_ГруппыУчетаОС - новое перечисление, аналогичное перечислению из БП КОРП
