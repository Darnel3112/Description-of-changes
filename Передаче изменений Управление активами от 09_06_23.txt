
ПЕР.ПЭП-01


ОбщийМодуль.ПР_Telegram.ДобавитьПричинуОтклонения - новая функция - записывает причину отклонения подписания и отправляет документ в статус На доработке
ОбщийМодуль.ПР_Telegram.ДокументыНаСогласовании - новая функция - получает ТЗ списка документов на согласовании у пользователя	
ОбщийМодуль.ПР_Telegram.ПодтвердитьСогласованиеДокумента - новая функция - подтверждает согласование подписанта и переводит документ в следующее состояние перемещения и отправляет уведомление следующему подписанту при необходимости
ОбщийМодуль.ПР_Telegram.ПолучитьГлавноеМеню - добавлен вывод кнопки "Документы на согласовании" в главном меню
ОбщийМодуль.ПР_Telegram.ПолучитьЗаявкиПоОчереди - вызов функции ПолучитьНомерСсылкуИнцидента переименован в ПолучитьНомерСсылку	
ОбщийМодуль.ПР_Telegram.ПолучитьМенюПеремещенияАктивов - новая функция - формирует кнопки меню карточки документа
ОбщийМодуль.ПР_Telegram.ПолучитьНомерСсылку - переименована функция ПолучитьНомерСсылкуИнцидента; добавление префикса документа при формировании ссылки-номера документа
ОбщийМодуль.ПР_Telegram.ПолучитьОписаниеЗаявки - изменена обработка получения ссылки документа при нажатии ссылки-номера	
ОбщийМодуль.ПР_Telegram.ПолучитьОписаниеПеремещенияАктивов - новая функция - формирует сообщение описание документа перемещения вместе с кнопками меню
ОбщийМодуль.ПР_Telegram.ПолучитьСписокВсехЗаявок - вызов функции ПолучитьНомерСсылкуИнцидента переименован в ПолучитьНомерСсылку
ОбщийМодуль.ПР_Telegram.ПолучитьСписокДокументовНаСогласовании - новая функция - в зависимости от количество документов на согласовании выводит: список документов, карточку документа, сообщение об отсутствии документов на согласовании
ОбщийМодуль.ПР_Telegram.ПолучитьСписокЗаявокЯИсполнитель - вызов функции ПолучитьНомерСсылкуИнцидента переименован в ПолучитьНомерСсылку
ОбщийМодуль.ПР_Telegram.ПолучитьСписокМоихЗаявок - вызов функции ПолучитьНомерСсылкуИнцидента переименован в ПолучитьНомерСсылку
ОбщийМодуль.ПР_Telegram.СоздатьНовуюЗаявку - вызов функции ПолучитьНомерСсылкуИнцидента переименован в ПолучитьНомерСсылку	
ОбщийМодуль.ПР_Telegram.СписокДокументовНаСогласовании - новая функция - получение текста сообщения со списком документов	на согласовании
ОбщийМодуль.ПР_Telegram.ТекущийПользовательЭтоПодписант - новая функция - проверка является ли текущий пользователю подписантом документа
ОбщийМодуль.ПР_Telegram.ДобавитьОповещениеДляОбработки - добавлена проверка на тип источника при записи инициатора
ОбщийМодуль.ПР_Telegram.ОбработкаСообщений - добавлена обработка нажатия кнопок для согласования документов перемещения активов; изменена обработка нажатия на открытие инидента
ОбщийМодуль.ПР_Telegram.ОтправкаУведомлений - новая экспортная процедура - вызывается в регламентом задании ПР_ОтправкаУведомленийTelegram - формирует оповещения в телеграмм для пользователей, у которых в наличии документы, ожидающие согласования
ОбщийМодуль.ПР_Telegram.ПолучитьИОтправитьПечатнуюФорму - новая процедура - формирует и отправляет файл печатной формы накладной на передачу основное
ОбщийМодуль.ПР_Telegram.РассылкаСообщений - изменен алгоритм формирования текста сообщения; добавлена обработка событий Согласование и Уведомление
ОбщийМодуль.ПР_Telegram.УстановитьЗначенияПользователя - добавлена обработка режима ввода ВводКомментарияОтклоненияСогласования

ОбщиеМодули.ПР_ОтправкаУведомлений.РЗ_ПР_ОтправкаПисемМенеджеру - новая процедура, вызывается регламентным заданием "ПР_ОтправкаПисемМенеджеру"
ОбщиеМодули.ПР_ОтправкаУведомлений.ПР_ОтправкаУведомленияОНеобходимостиРегистрацииВЧатБотеTelegram - новая процедура, отправка электронного письма пользователю о необходимости зарегистрировать в Telegram - боте
===========================================================================

РегламентоеЗадание.ПР_ОтправкаУведомленийTelegram - новое регламентное задание для отправки уведомлений о наличии документов на согласовании ЭП
РегламентоеЗадание.ПР_ОтправкаПисемМенеджеру - новое регламентное задание для отправки уведомлений менеджерам по закупке о расхождениях между заказом и поступлением

===========================================================================

Документ.itilprofПеремещениеАктивов:
1) Новые реквизиты:
    а) ПР_ПричинаОтклоненияСогласования - Строка (150)
    б) ПР_ТипТекущегоПодписанта - ПеречислениеСсылка.ПР_ТипыПодписантов
    в) ПР_ПредыдущееСостояние - ПеречислениеСсылка.ПР_СостоянияПеремещения
2) Новая табличная часть: ПР_ИсторияСогласования, реквизиты ТЧ:
    а) Подписант - СправочникСсылка.ФизическиеЛица
    б) Состояние - ПеречислениеСсылка.ПР_СостоянияСогласования
    в) ДатаСогласования - Дата
    г) Комментарий - Строка(1024)
    д) ТипПодписанта - ПеречислениеСсылка.ПР_ТипыПодписантов

Документ.itilprofПеремещениеАктивов.МодульМенеджера.ПолучитьНовоеСостояниеИлиПодписантаЭП - новая функция для получения следующего состояния и подписанта перемещения

===========================================================================

Документ.itilprofПеремещениеАктивов.ФормаДокумента:
1) Добавлены команды: "ПР_ОтправитьНаСогласование", "ПР_ОтозватьСогласование". Команды выведены на форму
2) Добавлена группа формы "СтраницаСогласования" в неё помещена таблица формы "ПР_ИсторияСогласования" со следующими полями:
    а) "ПР_ИсторияСогласованияПодписант"
    б) "ПР_ИсторияСогласованияСостояние"
    в) "ПР_ИсторияСогласованияДатаСогласования"
    г) "ПР_ИсторияСогласованияКомментарий"

Документ.itilprofПеремещениеАктивов.ФормаДокумента.ПолучитьМоментВремениДокумента - новая фукнция, возвращает текущую дату, или дату или момент времени документа.

Документ.itilprofПеремещениеАктивов.ФормаДокумента.ПР_ОтозватьСогласованиеНаСервере - новая функция - возвращает состояние перемещения в Новый
Документ.itilprofПеремещениеАктивов.ФормаДокумента.ПР_ОтправитьНаСогласованиеНаСервере - новая функция - получает следующее состояние перемещения документа 
и подписанта, отправляет документ на дальнейшее согласование

Документ.itilprofПеремещениеАктивов.ФормаДокумента.ПроверкаРегистрацииПодписантовВЧатБоте - новая функция - получает список незарегистрированных  подписантов в телеграмм

Документ.itilprofПеремещениеАктивов.ФормаДокумента.ЗаполнениеФирм - изменен параметр запроса "МоментВремени"
Документ.itilprofПеремещениеАктивов.ФормаДокумента.Подбор - изменен параметр "МоментВремени" передаваемый на форму "itilprofФормаПодбораАктивов"

Документ.itilprofПеремещениеАктивов.ФормаДокумента.ПР_ОтозватьСогласование - новая процедура - вызывает открытие диалогового окна для подтверждения сброса состояния согласования
Документ.itilprofПеремещениеАктивов.ФормаДокумента.ПР_ОтозватьСогласованиеЗавершить - новая процедура - вызывает сброс состояния согласования; изменяет отображение формы согласно новому состоянию
Документ.itilprofПеремещениеАктивов.ФормаДокумента.ПР_ОтправитьНаСогласование - новая процедура - отправляет документ на согласование, при необходимости 
вызывает диалоговое окно с предложением пропустить этап согласования доставщиком при его наличии

Документ.itilprofПеремещениеАктивов.ФормаДокумента.ПР_ОтправитьНаСогласованиеЗавершение - новая процедура - отправляет документ на согласование; изменяет отображение формы согласно новому состоянию
Документ.itilprofПеремещениеАктивов.ФормаДокумента.ПР_ОтправитьНаСогласованиеПродолжить - новая процедура - отправляет документ на согласование с параметром необходимости пропуска этапа 
согласования с доставщиком

Документ.itilprofПеремещениеАктивов.ФормаДокумента.ПриОткрытии - добавлена установка доступности формы в зависимости от состояния перемещения
Документ.itilprofПеремещениеАктивов.ФормаДокумента.УправлениеВидимостьюКнопокСогласования - новая процедура - изменяет отображение кнопок отправки/сброса согласования в зависимости от состояния перемещения

===========================================================================

Перечисление.ПР_ТипыПодписантов - новое перечисление для хранения типа текущего подписанта перемещения активов 
Перечисление.ПР_СостоянияСогласования - новое перечислениеЮ для хранения состояние согласования подписантом

===========================================================================

РегистрСведений.ПР_ПользователиTelegram.МодульМенеджера.ПолучитьПользователяПоФизЛицу - новая функция - производит поиск пользователя для отправки уведомлений в телеграмм по физ лицу
РегистрСведений.ПР_ПользователиTelegram.ФормаЗаписи.ПриСозданииНаСервере - Исправлена ошибка в условии

===========================================================================

РегистрСведений.ПР_ОповещенияДляОбработкиTelegram.Реквизиты.Источник - добавлен тип ДокументСсылка.itilprofПеремещениеАктивов

===========================================================================

РегистрСведений.пит_ГибкийРегистрАналитикОбмена.Ресурс.Значение - изменен тип с Строка(10) на Строка(150)
