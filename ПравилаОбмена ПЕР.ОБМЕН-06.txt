Данный файл содержит описание изменений в правилах обмена между ITIL и БП.
Изменения в правила вносились по трем ТЗ: ПЕР.ОБМЕН-06, ПЕР.ОБМЕН-08 и НСИ-08

===============================================Конвертация==============================================================================

Обработчик конвертации "Перед конвертацией объекта": Условия установки режима записи, дополнены новыми источниками.


==============================================Правила выгрузки данных=====================================================================

ПВД.ПР_РасходМатериаловДляОбмена: 
1) Добавлено новое правило выгрузки данных, необходимо для выгрузки документа "ПР_РасходМатериаловДляОбмена"
2) Используется стандартная выборка данных. В выборку попадают все элементы, зарегистрированный к обмену.
3) Используется ПКО.РасходМатериалов
4) События не используются
5) Алгоритмы/Запросы не используются

=============================================

ПВД.ПР_РеализацияТовараДляОбмена: 
1) Добавлено новое правило выгрузки данных, необходимо для выгрузки документа "ПР_РеализацияТовараДляОбмена"
2) Используется стандартная выборка данных. В выборку попадают все элементы, зарегистрированный к обмену.
3) Используется ПКО.РеализацияТовара
4) События не используются
5) Алгоритмы/Запросы не используются

=============================================

ПВД.ПР_ПередачаОСДляОбмена: 
1) Добавлено новое правило выгрузки данных, необходимо для выгрузки документа "ПР_ПередачаОСДляОбмена"
2) Используется стандартная выборка данных. В выборку попадают все элементы, зарегистрированный к обмену.
3) Используется ПКО.ПередачаОС
4) События не используются
5) Алгоритмы/Запросы не используются

=============================================

ПВД.ПР_ПеремещениеТоваровДляОбмена: 
1) Добавлено новое правило выгрузки данных, необходимо для выгрузки документа "ПР_ПеремещениеТоваровДляОбмена"
2) Используется стандартная выборка данных. В выборку попадают все элементы, зарегистрированный к обмену.
3) Используется ПКО.ПеремещениеТоваров
4) События не используются
5) Алгоритмы/Запросы не используются

=============================================

ПВД.ПР_ПоступлениеТоваровУслугДляОбмена: 
1) Добавлено новое правило выгрузки данных, необходимо для выгрузки документа "ПР_ПоступлениеТоваровУслугДляОбмена"
2) Используется стандартная выборка данных. В выборку попадают все элементы, зарегистрированный к обмену.
3) Используется ПКО.ПоступлениеТоваровУслугИзПеремещения
4) События не используются
5) Алгоритмы/Запросы не используются

=============================================

ПВД.ПР_ПринятиеКУчетуОСДляОбмена: 
1) Добавлено новое правило выгрузки данных, необходимо для выгрузки документа "ПР_ПринятиеКУчетуОСДляОбмена"
2) Используется стандартная выборка данных. В выборку попадают все элементы, зарегистрированный к обмену.
3) Используется ПКО.ПринятиеКУчетуОС
4) События не используются
5) Алгоритмы/Запросы не используются

=============================================

ПВД.ПР_ПеремещениеОСДляОбмена: 
1) Добавлено новое правило выгрузки данных, необходимо для выгрузки документа "ПР_ПеремещениеОСДляОбмена"
2) Используется стандартная выборка данных. В выборку попадают все элементы, зарегистрированный к обмену.
3) Используется ПКО.ПеремещениеОС
4) События не используются
5) Алгоритмы/Запросы не используются


==============================================Правила конвертации данных=====================================================================

ПКО.ПеремещениеТоваров:
1) Добавлено новое правило конвертации данных. Источник "ДокументСсылка.ПР_ПеремещениеТоваровДляОбмена"
Приемник "ДокументСсылка.ПеремещениеТоваров"

2) Поиск объекта в базе приемнике осуществляется по внутреннему идентификатору объекта, если объект не найден, то будет создан новый с соблюдением номерации
базы приемника

3) Для конвертации свойств используются: ПКО.Склады, ПКО.СтруктураПредприятия и ПКО.Номенклатура
4) Используется событие "После загрузки", где производится дозаполнение свойств объекта уникальных для приемника.
5) Алгоритмы/Запросы не используются
6) Нестандартные ПКС: 
    а) В ПКС.Актив → Номенклатура используется событие "Перед выгрузкой", где устанавливается значение в зависимости от условий

=============================================

ПКО.ПеремещениеОС
1) Добавлено новое правило конвертации данных. Источник "ДокументСсылка.ПР_ПеремещениеОСДляОбмена"
Приеминк "ДокументСсылка.ПеремещениеОС"

2) Поиск объекта в базе приемнике осуществляется по внутреннему идентификатору объекта, если объект не найден, то будет создан новый с соблюдением номерации
базы приемника

3) Для конвертации свойств используются: ПКО.ФизическиеЛица и ПКО.СтруктураПредприятия
4) Используется событие "После загрузки", где производится дозаполнение свойств объекта уникальных для приемника.
5) Используются следующие алгоритмы: "ЗаменаОСПоРегиструСоответствия", запросы не используются
6) Нестандартные ПКС: В группа ПКС "ОС" присутсвуют ПКС с передачей значения в параметр:
    а) "ГУИДПрихода" используется событие "Перед выгрузкой". Значение - ГУИД документа почучаемого запросом
    б) "ГУИДОС" используется событие "Перед выгрузкой". Значение - ГУИД элемента справочника "Активы"
    в) "ИнвентарныйНомер" используется событие "Перед выгрузкой". Значение - код элемента справочника "Активы"

=============================================

ПКО.ПринятиеКУчетуОС
1) Добавлено новое правило конвертации данных. Источник "ДокументСсылка.ПР_ПринятиеКУчетуОСДляОбмена"
Приеминк "ДокументСсылка.ПринятиеКУчетуОС"

2) Поиск объекта в базе приемнике осуществляется по внутреннему идентификатору объекта, если объект не найден, то будет создан новый с соблюдением номерации
базы приемника

3) Для конвертации свойств используются: ПКО.СтруктураПредприятия, ПКО.ГруппыОС, ПКО.НоменклатураЮ ПКО.ДоговорыКонтрагентов
ПКО.Контрагенты, ПКО.пит_Проекты, ПКО.ПоступлениеТоваровУслугИзПеремещения и ПКО.ПоступлениеТоваровУслуг

4) Используется событие "После загрузки", где производится дозаполнение свойств объекта уникальных для приемника.
Также в этом событии производится создание новых элементов справочника "Основные средства" и запись данных в регистр сведений "пр_ОсновныеСредстваITIL"

5) Используются:
    а) Алгоритмы: "ЗаменаОСПоРегиструСоответствия", "ЗаполнениеСведенийПрослеживаемостиПоПоступлениям", "ЗаполнениеСведенийПрослеживаемости"
    б) Запросы не используются

6) Нестандартные ПКС:
    а) ПКС ДокументПоступление → пит_ДокументПоступление в обработчике "Перед выгрузкой"
    зависимости от типа значения в источнике, производится выгрузка по указанному правилу
    б) Пареметр "ИсточникПринятия". Параметр представляет собой таблицу значений конвертированную в строку. 
    Значение параметра устанавливается в обработчике "Перед выгрузкой"

=============================================

ПКО.РасходМатериалов
1) Добавлено новое правило конвертации данных. Источник "ДокументСсылка.ПР_РасходМатериаловДляОбмена"
Приеминк "ДокументСсылка.ТребованиеНакладная"

2) Поиск объекта в базе приемнике осуществляется по внутреннему идентификатору объекта, если объект не найден, то будет создан новый с соблюдением номерации
базы приемника

3) Для конвертации свойств используются: ПКО.пит_Проекты, ПКО.СтатьиЗатрат
4) Используется событие "После загрузки", где производится дозаполнение свойств объекта уникальных для приемника.
5) Используются:
    а)Алгоритмы: "ЗаполнениеСведенийПрослеживаемости"
    б)Запросы: "ПоискПодразделения", "ПоискСчетаУчета"
6) Нестандартные ПКС - отсутствуют

=============================================

ПКО.РеализацияТовара
1) Добавлено новое правило конвертации данных. Источник "ДокументСсылка.ПР_РеализацияТовараДляОбмена"
Приеминк "ДокументСсылка.РеализацияТоваровУслуг"

2) Поиск объекта в базе приемнике осуществляется по внутреннему идентификатору объекта, если объект не найден, то будет создан новый с соблюдением номерации
базы приемника

3) Для конвертации свойств используются: ПКО.пит_Проекты и ПКО.СтатьиЗатрат, ПКО.СтавкиНДС
4) Используется событие "После загрузки", где производится дозаполнение свойств объекта уникальных для приемника.
5) Используются:
    а)Алгоритмы: "ЗаполнениеСведенийПрослеживаемости"
    б)Запросы: "ПоискПроектаПерепродажи", "ПоискКонтрагентаПоОрганизации", "ПоискДоговораПоКонтрагентуИОрганизации", "ПоискСтатьиДохода"
6) Нестандартные ПКС: 
    а)Заполнения значения ставки НДС, по умолчанию 20%
    б)ОрганизацияПолучатель → Параметр "ОрганизацияКонтрагент"

=============================================

ПКО.ПоступлениеТоваровУслугИзПеремещения
1) Добавлено новое правило конвертации данных. Источник "ДокументСсылка.ПР_ПоступлениеТоваровУслугДляОбмена"
Приеминк "ДокументСсылка.ПоступлениеТоваровУслуг"

2) Поиск объекта в базе приемнике осуществляется по внутреннему идентификатору объекта, если объект не найден, то будет создан новый с соблюдением номерации
базы приемника

3) Для конвертации свойств ПКО не используются
4) Используется событие "После загрузки", где производится дозаполнение свойств объекта уникальных для приемника.
Причем значения свойтсв могут браться как из документа "Реализация товаров услуг" так и из "Передача ОС" загруженных ранее
5) Используются:
    а)Алгоритмы не используются.
    б)Запросы: "ПоискПроектаПерепродажи", "ПоискКонтрагентаПоОрганизации", "ПоискДоговораПоКонтрагентуИОрганизации"
6) Нестандартные ПКС:
    а) ОрганизацияОтправитель → Параметр "ОрганизацияКонтрагент"
    б) ДокументВыдачи → Параметр "ВидДокументаВыдачи" используется обработчик "Перед выгрузкой". Значение изменяется в зависимости от типа данных реквизита источника
    в) ДокументВыдачи → Параметр "ГУИДДокументаВыдачи" используется обработчик "Перед выгрузкой". Значение либо гуид значения реквизита, либо пустая строка
    г) Параметр "ТаблицаСоответствийКЕ" используется обработчик "Перед выгрузкой". Собирается таблица значений, в которой есть связь между номенклатурой и основныеми средствами.

=============================================

ПКО.ПередачаОС
1) Добавлено новое правило конвертации данных. Источник "ДокументСсылка.ПР_ПередачаОСДляОбмена"
Приеминк "ДокументСсылка.ПередачаОС"

2) Поиск объекта в базе приемнике осуществляется по внутреннему идентификатору объекта, если объект не найден, то будет создан новый с соблюдением номерации
базы приемника

3) Для конвертации свойств используются: ПКО.КлассификаторЕдиницИзмерения
4) Используется событие "После загрузки", где производится дозаполнение свойств объекта уникальных для приемника.
5) Используются:
    а)Алгоритмы: "ЗаполнениеСведенийПрослеживаемости", "ЗаменаОСПоРегиструСоответствия", "РасчетЦеныСуммыСуммыНДСПередачаОС"
    б)Запросы: "ПоискКатегорииДоговора", "УчавствуетВЭДОЗапрос", "ПоискПроектаПерепродажи", "ПоискКонтрагентаПоОрганизации", "ПоискДоговораПоКонтрагентуИОрганизации",
    "ПоискСтатьиДохода", "ПоискСтатьиДохода652"
6) Нестандартные ПКС:
    а) Группа ПКС "ОС":
        а1) Параметр "СтавкаНДС", используется обработчик "Перед выгрузкой". Значение по умолчанию 20%
        а2) Параметр "ГУИДПрихода", используется обработчик "Перед выгрузкой". Запросом находится по условиям документ прихода актива и его гуид
        а3) Параметр "ГУИДОС", используется обработчик "Перед выгрузкой". Значение - гуид актива
        а4) Параметр "ИнвентарныйНомер", используется обработчик "Перед выгрузкой". Значение - код актива
    б) ОрганизацияПолучатель → Параметр "ОрганизацияКонтрагент"

=============================================

ПКО.СтатьиЗатрат
1) Добавлено новое правило конвертации данных. Источник "СправочникСсылка.СтатьиЗатрат"
Приеминк "СправочникСсылка.СтатьиЗатрат"

2) Поиск объекта в базе приемнике осуществляется по внутреннему идентификатору объекта, если объект не найден, то 
дальше происходит поиск по полям "Код", "Наименование", "Родитель", "ЭтоГруппа". Если объект не найден, то новый создаваться не будет

3) Для конвертации свойств используются: ПКО.СтатьиЗатрат
4) События не используются
5) Алгоритмы и запросы не используются
6) Нестандартные ПКС неиспользуются

=============================================

ПКО.ГруппыОС
1) Добавлено новое правило конвертации данных. Источник "ПеречислениеСсылка.ПР_ГруппыУчетаОС"
Приеминк "ПеречислениеСсылка.ГруппыОС"

2) Объекты приемника и источника сопоставлены в ПКО
3) Для конвертации свойств ПКО не используются
4) События не используются
5) Алгоритмы и запросы не используются
6) Нестандартные ПКС неиспользуются


==============================================Запросы=====================================================================
1) "ПоискДоговораПоКонтрагентуИОрганизации"
Поиск в ГРАО договора по разделу "Обмен_БП_ITIL", ключу "СопоставлениеДоговоров", контрагенту и организации нужного договора
Значение договора заполняется в документах: "Передача ОС", "Поступление товаров услуг", "Реализация товаров услуг"

2) "ПоискКатегорииДоговора"
Поиск в ГРАО категории договора по разделу "Обмен_БП_ITIL" и ключу "ПередачаОСКатегорияДоговора"
Значение категории договора, используется для условного заполнения значения реквизита "ВосстановитьАмортизационнуюПремию"
в документе "Передача ОС"

3) "ПоискКонтрагентаПоОрганизации"
Поиск в ГРАО контрагента по организации, разделу "Обмен_БП_ITIL" и ключу "СопоставлениеОрганизаций"
Значение контрагента заполняется в документах: "Передача ОС", "Поступление товаров услуг", "Реализация товаров услуг"

4) "ПоискПодразделения"
Поиск в ГРАО подразделения по организации, разделу "Обмен_БП_ITIL" и ключу. Ключ передается параметром.
Значение подразделения необходимо для условного заполнения реквизита "СчетЗатрат" в документе "Расход материлов"

5) "ПоискПроектаПерепродажи"
Поиск в ГРАО проекта по разделу "Обмен_БП_ITIL" и ключу "ПроектДляПерепродажи".
Значение проекта заполняется в документах: "Передача ОС", "Поступление товаров услуг", "Реализация товаров услуг"

6) "ПоискСтатьиДохода"
Поиск в ГРАО статьи дохода по разделу "Обмен_БП_ITIL" и ключу "Реализация_СтатьяДохода_ПередачаОС_Субконто".
Значение статьи дохода заполняется в документах: "Передача ОС", "Реализация товаров услуг"

7) "ПоискСтатьиДохода652"
Поиск в ГРАО статьи дохода по разделу "Обмен_БП_ITIL" и ключу "Субконто652".
Значение статьи дохода заполняется в документе "Передача ОС"

8) "ПоискСчетаУчета"
Поиск в ГРАО статьи дохода по разделу "Обмен_БП_ITIL" и ключу. Ключ передается параметром.
Значение счета учета заполняется в документе "Расход материалов"

9) "УчавствуетВЭДОЗапрос"
Поиск в дополнительных реквизитах признака контрагента "Участвует в ЭДО"
Для заполнения реквизита документа "Передача ОС"